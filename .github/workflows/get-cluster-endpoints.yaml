# Quick workflow to get EKS cluster endpoints
name: "üîç Get Cluster Endpoints"

on:
  workflow_dispatch:

env:
  AWS_REGION: us-east-1

jobs:
  get-endpoints:
    runs-on: ubuntu-latest
    steps:
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: List EKS Clusters and Endpoints
        run: |
          echo "=============================================="
          echo "EKS CLUSTERS IN us-east-1"
          echo "=============================================="
          
          CLUSTERS=$(aws eks list-clusters --query 'clusters' --output json)
          echo "Clusters found: $CLUSTERS"
          echo ""
          
          for CLUSTER in $(echo "$CLUSTERS" | jq -r '.[]'); do
            echo "----------------------------------------------"
            echo "CLUSTER: $CLUSTER"
            echo "----------------------------------------------"
            
            INFO=$(aws eks describe-cluster --name "$CLUSTER" --output json)
            
            ENDPOINT=$(echo "$INFO" | jq -r '.cluster.endpoint')
            STATUS=$(echo "$INFO" | jq -r '.cluster.status')
            VERSION=$(echo "$INFO" | jq -r '.cluster.version')
            
            echo "  Status:   $STATUS"
            echo "  Version:  $VERSION"
            echo "  Endpoint: $ENDPOINT"
            echo ""
          done
          
          echo "=============================================="
          echo "SUMMARY"
          echo "=============================================="
          echo "Total clusters: $(echo "$CLUSTERS" | jq '. | length')"
