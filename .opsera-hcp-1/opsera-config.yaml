# ════════════════════════════════════════════════════════════════════════════
# OPSERA CONFIG - Single Source of Truth (RULE 60)
# Application: hcp-1 | Generated by Code-to-Cloud Enterprise v1.6
# ════════════════════════════════════════════════════════════════════════════

version: "1.6"
generated: "2026-01-29"

# ─────────────────────────────────────────────────────────────────────────────
# APPLICATION SETTINGS
# ─────────────────────────────────────────────────────────────────────────────
app:
  name: hcp-1
  type: frontend           # frontend | backend | fullstack
  framework: react-vite
  language: typescript
  port: 80                 # Container port (nginx)

# ─────────────────────────────────────────────────────────────────────────────
# GITHUB SETTINGS
# ─────────────────────────────────────────────────────────────────────────────
github:
  org: gayathri-opsera
  repo: healthcp
  branch: main
  repo_url: https://github.com/gayathri-opsera/healthcp.git

# ─────────────────────────────────────────────────────────────────────────────
# AWS SETTINGS
# ─────────────────────────────────────────────────────────────────────────────
aws:
  region: us-east-1
  account_id: "${AWS_ACCOUNT_ID}"    # Set via GitHub Secret
  
  # ECR Repository
  ecr:
    repository: hcp-1-frontend
    uri: "${AWS_ACCOUNT_ID}.dkr.ecr.us-east-1.amazonaws.com/hcp-1-frontend"
  
  # EKS Cluster (Hub-Spoke Architecture)
  eks:
    # RULE 70-71: Cluster naming convention
    hub_cluster: argocd-use1           # ArgoCD hub cluster
    spoke_cluster: opsera-use1-np      # Workload spoke cluster (non-prod)
    
# ─────────────────────────────────────────────────────────────────────────────
# ARGOCD SETTINGS (Hub-Spoke Architecture)
# ─────────────────────────────────────────────────────────────────────────────
argocd:
  namespace: argocd
  # RULE 59: ALWAYS use destination.name for hub-spoke
  destination:
    name: opsera-use1-np              # Spoke cluster name (NOT server URL!)
  project: default
  sync_policy:
    automated: false                  # RULE 65: Disable until DEV verified
    prune: true
    self_heal: true

# ─────────────────────────────────────────────────────────────────────────────
# ENVIRONMENT CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────
environments:
  dev:
    enabled: true
    namespace: hcp-1-dev
    replicas: 2
    strategy: rolling
    # RULE 64: Correct domain (agent.opsera.dev NOT agents.opsera.dev)
    domain: hcp-1-dev.agent.opsera.dev
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

# ─────────────────────────────────────────────────────────────────────────────
# CI/CD SETTINGS
# ─────────────────────────────────────────────────────────────────────────────
cicd:
  # RULE 68: Use AWS Access Keys by default (NOT OIDC)
  auth_method: access_keys
  
  # Build settings
  build:
    dockerfile: ./Dockerfile
    context: .
    
  # Deployment settings
  deploy:
    auto_promote: false               # RULE 65: Disabled until DEV verified
    timeout_dev: 300                  # 5 minutes
    timeout_qa: 600                   # 10 minutes (canary)
    timeout_staging: 600              # 10 minutes (blue-green)

# ─────────────────────────────────────────────────────────────────────────────
# INTEGRATIONS (Optional)
# ─────────────────────────────────────────────────────────────────────────────
integrations:
  slack:
    enabled: false                    # Set to true and add SLACK_WEBHOOK_URL secret
    channel: "#deployments"
  jira:
    enabled: false                    # Set to true and add JIRA_* secrets
  newrelic:
    enabled: false                    # Set to true and add NEWRELIC_API_KEY secret

# ─────────────────────────────────────────────────────────────────────────────
# REQUIRED GITHUB SECRETS
# ─────────────────────────────────────────────────────────────────────────────
# The following secrets MUST be configured in GitHub repository settings:
#
# REQUIRED:
#   AWS_ACCESS_KEY_ID      - AWS access key for ECR/EKS access
#   AWS_SECRET_ACCESS_KEY  - AWS secret key
#   AWS_ACCOUNT_ID         - AWS account ID (12 digits)
#   GH_PAT                 - GitHub Personal Access Token (for ArgoCD repo access)
#
# OPTIONAL:
#   SLACK_WEBHOOK_URL      - Slack webhook for notifications
#   JIRA_API_TOKEN         - Jira API token
#   JIRA_EMAIL             - Jira account email
#   NEWRELIC_API_KEY       - NewRelic API key for APM analysis
